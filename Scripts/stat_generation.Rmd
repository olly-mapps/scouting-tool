---
title: "Sandbox"
output: html_notebook
author: "olly-mapps"
---

Contained in this notebook is the sandbox for code that I plan to use for a football scouting tool 


# Libraries
```{r}
library(tidyverse)
library(worldfootballR)
```

# Data Loading

We first define stat types to extract from worldsoccerR

```{r}
#Define stat types
stat_types = c("standard", "shooting", "passing", "passing_types", "gca", "defense", "possession", "playing_time", "misc", "keepers", "keepers_adv")
```

We next define a loop to extract these data based on the stat type

```{r}
#Define loop to iterate through the stat types
for (type in stat_types){
  
  #Load the data for the specific type
  temp <- data.frame(load_fb_big5_advanced_season_stats(stat_type = type, 
                                             team_or_player = "player"))
  #Print type to assess progress
  print(type)
  
  temp["Season_End_Year"] <- as.character(temp["Season_End_Year"])
  
  #Assign the data a suitable name
  assign(paste(type, "_stats", sep = ""), get("temp"))
}
```

There are numeric columns that we don't need, so we drop them here. We also drop na values and convert the date to character for later

```{r}
#Define columns to leave out 
not_columns <- c("Age", "Born", "Prog", "A_minus_xA", "xAG", "A_minus_xAG", "PrgP")

type_list_raw <- list(standard_stats, shooting_stats, passing_stats, passing_types_stats, gca_stats, defense_stats, possession_stats, playing_time_stats, misc_stats, keepers_stats, keepers_adv_stats)

type_list <- lapply(type_list_raw, function(x) x %>% 
                      dplyr::select(-any_of(not_columns)) %>% 
                      na.omit(.))

type_list <- setNames(type_list, stat_types)
```

# Converting to Stats

We next convert each column of each data-frame to percentiles, which we can imagine as standardized
'attributes'

```{r}
for (type in stat_types){
  for (col in colnames(dplyr::select(type_list[[type]], where(is.numeric), -Season_End_Year))){
    type_list[[type]][col] <- round(cume_dist(type_list[[type]][col])*100)
  }
}
```

# Finding Transfers 

```{r}
test <- type_list[["passing"]]
test
```

```{r}
transferred_player <-  test %>% 
                        group_by(Player) %>% 
                        dplyr::filter(n_distinct(Squad) > 1) %>% 
                        ungroup()

transferred_player
```

```{r}
test %>% dplyr::filter(test["Season_End_Year"] == 2023)
```

```{r}
messi <- transferred_player %>% dplyr::filter(transferred_player["Player"] == "Lionel Messi")
```

We wish to find averages of the statistics at each club, which we can then use to calculate the differences between leagues

```{r}
#First we calculate averages across each team the player has played for
messi %>% group_by(Squad, Player, Comp) %>% 
          summarise(across(where(is.numeric), mean),
                    .groups = 'drop')
```
```{r}

```

#Write to csv

We finally write or dataframes to .csv files

```{r}
write.csv(player_standard, "../Data/standard_stats.csv")
write.csv(player_shooting, "../Data/shooting_stats.csv")
write.csv(player_passing, "../Data/passing_stats.csv")
write.csv(player_gca, "../Data/gca_stats.csv")
write.csv(player_defense, "../Data/defense_stats.csv")
write.csv(player_possession, "../Data/possession_stats.csv")
write.csv(player_playing_time, "../Data/playing_time_stats.csv")
write.csv(player_misc, "../Data/misc_stats.csv")
write.csv(player_keepers, "../Data/keepers_stats.csv")
write.csv(player_keepers_adv, "../Data/keepers_adv_stats.csv")
```

